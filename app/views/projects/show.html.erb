<h1><%= @project.name %></h1>

<h3>This project is due in <%= @project.days_remaining %> days (<%= @project.weeks_remaining %> weeks)</h3><br>

<!-- Show users assigned to project -->
<h4>Assigned Users: </h4>
  <% if @project.users.empty? %>
    <p>There are currently no users assigned to this project</p>
  <% else %>

    <table>
      <thead>
        <tr>
          <th>Username</th>
          <th>Contact</th>
          <th>Details</th>
          <th># of tasks assigned</th>
          <th>Action</th>
        </tr>
      </thead>
      <tbody>
        <p><%= render(@project.users.uniq) %></p>
      </tbody>
    </table>
  <% end %>

<!-- Show tasks in project -->
<h4>Project Tasks - <%= @project.tasks.count %></h4>
<% if @project.tasks.empty? %>
  <p>There are currently no users assigned to this project</p>
<% else %>
  <% if !params[:filter_user_id].blank? %>
    <% @project.tasks = Task.where(user_id: params[:filter_user_id], project_id: params[:id]) %>
  <% end %>

<!-- Filter control -->
  <div>
    <h5>Filter tasks:</h5>
    <%= form_tag(project_path(@project), method: "get") do %>
      <%= select_tag "filter_user_id", options_from_collection_for_select(User.all, "id", "username"), include_blank: true %>
      <%= submit_tag "Filter" %>
    <% end %>
  </div>
      <table>
        <thead>
          <tr>
            <th>Title</th>
            <th>Assignee</th>
            <th>Percent Complete</th>
            <th>Action</th>
          </tr>
        </thead>
        <tbody>
          <p><%= render partial: "tasks/task", collection: @project.tasks %></p>
        </tbody>
      </table>

<% end %>


<!-- Show deadline -->
<h4>Project Deadline: </h4>
<p><%= due_date @project %></p>

<!-- Add TASK -->
<h4><%= link_to "Add task to project", new_task_path %></h4>

<%= form_for @project, method: :delete do |f| %>
  <%= f.submit "Delete project" %><br/>
<% end %>
